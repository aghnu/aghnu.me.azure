(()=>{"use strict";var e={};function t(e,t){e.innerHTML="";let r=!0;for(let o=0;o<t.length;o++){const n=document.createElement("span"),s=1.5*Math.random()+1,a=1,c=.25*Math.random()+.1;let i;n.style.transition=`opacity ${s}s`,n.innerHTML=t[o],n.style.opacity=[a,c][Math.floor(2*Math.random())];const l=()=>{n.style.opacity===String(a)?n.style.opacity=String(c):n.style.opacity=String(a),i=setTimeout((()=>{r&&l()}),1e3*Math.random()+1e3*s)};i=setTimeout((()=>{l()}),100),e.appendChild(n)}return()=>{r=!1}}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&(t=r.currentScript.src),!t)){var o=r.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const r="https://wnfafunctions.azurewebsites.net/api/wnfapostersgen",o=e.p+"1a83ba729d21aacde07e5a9b42851b49.webp",n=[{class:"monitor-0",url:e.p+"7e3a3d2864369a3cb03474ebc7b96d16.webp"},{class:"monitor-1",url:e.p+"2603184f8e48829b2f0319d11ebe12a3.webp"},{class:"monitor-2",url:e.p+"4a32a38a0b28065916c3de8f387dfdce.webp"},{class:"monitor-3",url:e.p+"d5c110bd156802ccf519b3c499d8dd9d.webp"}],s={frameInit_0:!1,frameInit_1:!1,frameInit_2:!1,frameInit_3:!1,posterInit:!1,fontsLoaded:!1};let a=!1,c=!1;function i(){const e=document.querySelector("#site-structure .floor .monitor .poster");e.addEventListener("load",(()=>{s.posterInit=!0}),{once:!0}),e.src=o;const t=document.querySelector("#site-structure .floor .monitor .monitor-frame.monitor-0"),r=document.querySelector("#site-structure .floor .monitor .monitor-frame.monitor-1"),i=document.querySelector("#site-structure .floor .monitor .monitor-frame.monitor-2"),l=document.querySelector("#site-structure .floor .monitor .monitor-frame.monitor-3");t.addEventListener("load",(()=>{s.frameInit_0=!0}),{once:!0}),r.addEventListener("load",(()=>{s.frameInit_1=!0}),{once:!0}),i.addEventListener("load",(()=>{s.frameInit_2=!0}),{once:!0}),l.addEventListener("load",(()=>{s.frameInit_3=!0}),{once:!0}),t.src=n[0].url,r.src=n[1].url,i.src=n[2].url,l.src=n[3].url;const d=document.querySelector("#site-structure .floor .monitor");let u=Math.floor(Math.random()*n.length);d.classList.add(n[u].class),function(e,t,r){let o;const s=()=>{o=setTimeout((()=>{a||c||function(e,t){const r=e.style.display;e.style.display="none",setTimeout((()=>{e.style.display=r,setTimeout((()=>{e.style.display="none",setTimeout((()=>{t(),e.style.display=r}),50)}),80)}),50)}(d,(()=>{d.classList.remove(n[u].class),u=(u+1)%n.length,d.classList.add(n[u].class)})),s()}),Math.floor(5001*Math.random())+1e4)};s()}(),document.fonts.ready.then((()=>{s.fontsLoaded=!0}))}function l(){const e=document.querySelector("#site-structure"),n=document.querySelector("#site-structure .footer .first"),s=document.querySelector("#site-structure .footer .second");t(n,"GENGYUAN HUANG & YUAN FANG"),t(s,"© 2022 WNFA Poster Generator");const l=document.querySelector("#site-console .input"),d=[["Type into this area to write a poem, then, click the display device to generate the poster.",.075],["点击这里写一首诗，然后单击显示装置生成海报。",.2],["荷叶滴落泪水\n来不及 浸透书页\n一百年 一千年\n点燃一片通电的网\n\n回想 回想\n那心的铁片\n也要发出轰响",.2]],u=()=>{const e=d.shift();var t,r,o,n,s;d.push(e),t=e[0],r=e[1],o=()=>l.placeholder,n=e=>l.placeholder=e,s=()=>{setTimeout((()=>{!function(e,t,r,o){const n=()=>{setTimeout((()=>{var e;""!==t()?(e=t().slice(0,-1),l.placeholder=e,n()):setTimeout((()=>{u()}),2e3)}),.05*Math.random()*1e3)};n()}(0,(()=>l.placeholder))}),2e3)},(e=>{let t=0;const a=()=>{setTimeout((()=>{if(t<e.length){const r=e[t++];n(o()+r),a()}else s()}),Math.random()*r*1e3+25)};a()})(t)};u();const m=document.querySelector("#site-structure .prompt");var p,f;t(m,"Server Starting / 服务器启动中"),e.classList.add("processing"),p=()=>{t(m,"System Ready / 系统就绪"),e.classList.remove("processing")},f=()=>{t(m,"Server Error / 服务器错误"),e.classList.add("processing")},fetch(r+"?server=wakeup").then((e=>{200===e.status?p&&p():f&&f()})).catch((()=>{f&&f()}));const h=document.querySelector("#site-structure .floor .monitor"),y=document.querySelector("#site-structure .floor .monitor .poster");let v,g,L="";const S=()=>{""!==l.value&&l.value!==L&&(a=!0,t(m,"Generating / 生成中"),e.classList.add("processing"),l.blur(),function(n,s,c){fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n})}).then((r=>{200===r.status?r.json().then((r=>{(r=>{a=!1,g=b,e.classList.remove("processing"),t(m,"Poster Ready / 海报就绪"),y.src="data:image/jpeg; base64, "+r.image_data,L=l.value,l.addEventListener("input",(()=>{g=S,L="",y.src=o,t(m,"System Ready / 系统就绪")}),{once:!0})})(r)})):400===r.status?c(1001):c(1002)})).catch((()=>{c(1003)}))}(l.value,0,(r=>{switch(a=!1,e.classList.remove("processing"),console.error("ERROR: "+r),r){case 1003:t(m,"Network Error / 网络错误");break;case 1002:t(m,"Sever Error / 服务器错误");break;case 1001:L=l.value,t(m,"Invalid input / 文本不规范")}})))},b=()=>{const e=document.querySelector("#site-posterview");e.innerHTML="";const t=document.createElement("img");t.classList.add("poster"),t.src=y.src,e.appendChild(t),e.addEventListener("click",(()=>{e.classList.remove("show")}),{once:!0}),e.classList.add("show")};var w,E,T;v=()=>{},g=S,E=()=>{h.classList.add("pressed")},T=()=>{h.classList.remove("pressed"),g()},(w=h).addEventListener("touchstart",(e=>{e.preventDefault(),c=!0,E()})),w.addEventListener("touchend",(e=>{e.preventDefault(),c=!1,T()})),w.addEventListener("touchcancel",(e=>{e.preventDefault(),c=!1,T()})),w.addEventListener("mousedown",(e=>{e.preventDefault(),c=!0,E()})),w.addEventListener("mouseup",(e=>{e.preventDefault(),c=!1,T()})),document.addEventListener("mouseup",(e=>{c&&(c=!1,T())})),i()}window.addEventListener("load",(function(){l();const e=document.querySelector("#site-informative .loading .prompt"),t=["·","· ·","· · ·"];let r=0,o=()=>{};setInterval((()=>{e.innerHTML="Loading / 载入中<br>"+t[r],r=(r+1)%t.length,o()}),750),setTimeout((()=>{o=()=>{(function(){for(const e in s)if(!s[e])return!1;return!0})()&&document.querySelector("#site-informative .loading").classList.add("hide")}}),2250)}))})();