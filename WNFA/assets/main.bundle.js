(()=>{"use strict";var e={};function t(e,t){e.innerHTML="";let r=!0;for(let o=0;o<t.length;o++){const s=document.createElement("span"),n=1.5*Math.random()+1,a=1,c=.25*Math.random()+.1;let i;s.style.transition=`opacity ${n}s`,s.innerHTML=t[o],s.style.opacity=[a,c][Math.floor(2*Math.random())];const l=()=>{s.style.opacity===String(a)?s.style.opacity=String(c):s.style.opacity=String(a),i=setTimeout((()=>{r&&l()}),1e3*Math.random()+1e3*n)};i=setTimeout((()=>{l()}),100),e.appendChild(s)}return()=>{r=!1}}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&(t=r.currentScript.src),!t)){var o=r.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const r="https://wnfafunctions.azurewebsites.net/api/wnfapostersgen",o=e.p+"1a83ba729d21aacde07e5a9b42851b49.webp",s=[{class:"monitor-0",url:e.p+"7e3a3d2864369a3cb03474ebc7b96d16.webp"},{class:"monitor-1",url:e.p+"2603184f8e48829b2f0319d11ebe12a3.webp"},{class:"monitor-2",url:e.p+"4a32a38a0b28065916c3de8f387dfdce.webp"},{class:"monitor-3",url:e.p+"d5c110bd156802ccf519b3c499d8dd9d.webp"}],n={frameInit_0:!1,frameInit_1:!1,frameInit_2:!1,frameInit_3:!1,posterInit:!1,fontsLoaded:!1};let a=!1,c=!1;function i(){const e=document.querySelector("#site-structure .floor .monitor .poster");e.addEventListener("load",(()=>{n.posterInit=!0}),{once:!0}),e.src=o;const t=document.querySelector("#site-structure .floor .monitor .monitor-frame.monitor-0"),r=document.querySelector("#site-structure .floor .monitor .monitor-frame.monitor-1"),i=document.querySelector("#site-structure .floor .monitor .monitor-frame.monitor-2"),l=document.querySelector("#site-structure .floor .monitor .monitor-frame.monitor-3");t.addEventListener("load",(()=>{n.frameInit_0=!0}),{once:!0}),r.addEventListener("load",(()=>{n.frameInit_1=!0}),{once:!0}),i.addEventListener("load",(()=>{n.frameInit_2=!0}),{once:!0}),l.addEventListener("load",(()=>{n.frameInit_3=!0}),{once:!0}),t.src=s[0].url,r.src=s[1].url,i.src=s[2].url,l.src=s[3].url;const d=document.querySelector("#site-structure .floor .monitor");let u=Math.floor(Math.random()*s.length);d.classList.add(s[u].class),function(e,t,r){let o;const n=()=>{o=setTimeout((()=>{a||c||function(e,t){const r=e.style.display;e.style.display="none",setTimeout((()=>{e.style.display=r,setTimeout((()=>{e.style.display="none",setTimeout((()=>{t(),e.style.display=r}),50)}),80)}),50)}(d,(()=>{d.classList.remove(s[u].class),u=(u+1)%s.length,d.classList.add(s[u].class)})),n()}),Math.floor(5001*Math.random())+15e3)};n()}(),document.fonts.ready.then((()=>{n.fontsLoaded=!0}))}function l(){const e=document.querySelector("#site-structure"),s=document.querySelector("#site-structure .footer .first"),n=document.querySelector("#site-structure .footer .second");t(s,"GENGYUAN HUANG & YUAN FANG"),t(n,"© 2022 WNFA Poster Generator");const l=document.querySelector("#site-console .input"),d=document.querySelector("#site-console-prompt"),u=[["Type into this area to write a poem, then, click the display device to generate the poster.",.075],["点击这里写一首诗，然后单击显示装置生成海报。",.2],["荷叶滴落泪水\n来不及 浸透书页\n一百年 一千年\n点燃一片通电的网\n\n回想 回想\n那心的铁片\n也要发出轰响",.2]];let m;l.maxLength=500,l.value="",l.addEventListener("input",(()=>{clearTimeout(m),d.classList.add("show"),l.value.length>=500?d.classList.add("alert"):d.classList.remove("alert"),d.innerHTML=String(l.value.length)+"/"+String(500),m=setTimeout((()=>{d.classList.remove("show")}),5e3)}));const p=()=>{const e=u.shift();var t,r,o,s,n;u.push(e),t=e[0],r=e[1],o=()=>l.placeholder,s=e=>l.placeholder=e,n=()=>{setTimeout((()=>{!function(e,t,r,o){const s=()=>{setTimeout((()=>{var e;""!==t()?(e=t().slice(0,-1),l.placeholder=e,s()):setTimeout((()=>{p()}),2e3)}),.05*Math.random()*1e3)};s()}(0,(()=>l.placeholder))}),2e3)},(e=>{let t=0;const a=()=>{setTimeout((()=>{if(t<e.length){const r=e[t++];s(o()+r),a()}else n()}),Math.random()*r*1e3+25)};a()})(t)};p();const f=document.querySelector("#site-structure .prompt");var h,v;t(f,"Server Starting / 服务器启动中"),e.classList.add("processing"),a=!0,h=()=>{a=!1,t(f,"System Ready / 系统就绪"),e.classList.remove("processing")},v=()=>{t(f,"Server Error / 服务器错误"),e.classList.add("processing")},fetch(r+"?server=wakeup").then((e=>{200===e.status?h&&h():v&&v()})).catch((()=>{v&&v()}));const y=document.querySelector("#site-structure .floor .monitor"),L=document.querySelector("#site-structure .floor .monitor .poster");let g,S,b="";const w=()=>{""!==l.value&&l.value!==b&&(a=!0,t(f,"Generating / 生成中"),e.classList.add("processing"),l.blur(),function(s,n,c){fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:s})}).then((r=>{200===r.status?r.json().then((r=>{(r=>{a=!1,S=E,e.classList.remove("processing"),t(f,"Poster Ready / 海报就绪"),L.src="data:image/jpeg; base64, "+r.image_data,b=l.value,l.addEventListener("input",(()=>{S=w,b="",L.src=o,t(f,"System Ready / 系统就绪")}),{once:!0})})(r)})):400===r.status?c(1001):c(1002)})).catch((()=>{c(1003)}))}(l.value,0,(r=>{switch(a=!1,e.classList.remove("processing"),console.error("ERROR: "+r),r){case 1003:t(f,"Network Error / 网络错误");break;case 1002:t(f,"Sever Error / 服务器错误");break;case 1001:b=l.value,t(f,"Invalid input / 文本不规范")}})))},E=()=>{const e=document.querySelector("#site-posterview");e.innerHTML="";const t=document.createElement("img");t.classList.add("poster"),t.src=L.src,e.appendChild(t),e.addEventListener("click",(()=>{e.classList.remove("show")}),{once:!0}),e.classList.add("show")};var T,q,M;g=()=>{},S=w,q=()=>{y.classList.add("pressed")},M=()=>{y.classList.remove("pressed"),S()},(T=y).addEventListener("touchstart",(e=>{e.preventDefault(),c=!0,q()})),T.addEventListener("touchend",(e=>{e.preventDefault(),c=!1,M()})),T.addEventListener("touchcancel",(e=>{e.preventDefault(),c=!1,M()})),T.addEventListener("mousedown",(e=>{e.preventDefault(),c=!0,q()})),T.addEventListener("mouseup",(e=>{e.preventDefault(),c=!1,M()})),document.addEventListener("mouseup",(e=>{c&&(c=!1,M())})),i()}window.addEventListener("load",(function(){l();const e=document.querySelector("#site-informative .loading .prompt"),t=["·","· ·","· · ·"];let r=0,o=()=>{};setInterval((()=>{e.innerHTML="Loading / 载入中<br>"+t[r],r=(r+1)%t.length,o()}),750),setTimeout((()=>{o=()=>{(function(){for(const e in n)if(!n[e])return!1;return!0})()&&document.querySelector("#site-informative .loading").classList.add("hide")}}),2250)}))})();