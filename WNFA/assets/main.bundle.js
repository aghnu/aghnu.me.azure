(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&(t=r.currentScript.src),!t)){var o=r.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=e.p+"1a83ba729d21aacde07e5a9b42851b49.webp",r=e.p+"29a6d5b43479e7d1a4cd3193be23b3c0.webp",o=e.p+"fcb7aacce0263814ff1db4eee0e74605.webp",n=e.p+"4a32a38a0b28065916c3de8f387dfdce.webp";function s(e,t){e.innerHTML="";let r=!0;for(let o=0;o<t.length;o++){const n=document.createElement("span"),s=1.5*Math.random()+1,a=1,c=.25*Math.random()+.1;let i;n.style.transition=`opacity ${s}s`,n.innerHTML=t[o],n.style.opacity=[a,c][Math.floor(2*Math.random())];const d=()=>{n.style.opacity===String(a)?n.style.opacity=String(c):n.style.opacity=String(a),i=setTimeout((()=>{r&&d()}),1e3*Math.random()+1e3*s)};i=setTimeout((()=>{d()}),100),e.appendChild(n)}return()=>{r=!1}}const a=[{class:"monitor-0",url:r},{class:"monitor-1",url:o},{class:"monitor-2",url:n}],c={frameInit:!1,posterInit:!1,fontsLoaded:!1};function i(){const e=document.querySelector("#site-structure"),r=document.querySelector("#site-structure .footer .first"),o=document.querySelector("#site-structure .footer .second");s(r,"GENGYUAN HUANG & YUAN FANG"),s(o,"© 2022 WNFA Posters Generator");const n=document.querySelector("#site-console .input"),i=[["Type into this area to write a poem, then, click the TV to generate the poster.",.075],["点击这里写一首诗，然后点击电视机开始生成海报。",.2],["荷叶滴落泪水，来不及浸透书页。\n一百年一千年，点燃一片通电的网。\n\n回想回想，\n那心的铁片，\n也要发出轰响。",.2]],d=()=>{const e=i.shift();var t,r,o,s,a;i.push(e),t=e[0],r=e[1],o=()=>n.placeholder,s=e=>n.placeholder=e,a=()=>{setTimeout((()=>{!function(e,t,r,o){const s=()=>{setTimeout((()=>{var e;""!==t()?(e=t().slice(0,-1),n.placeholder=e,s()):setTimeout((()=>{d()}),2e3)}),.05*Math.random()*1e3)};s()}(0,(()=>n.placeholder))}),2e3)},(e=>{let t=0;const n=()=>{setTimeout((()=>{if(t<e.length){const r=e[t++];s(o()+r),n()}else a()}),Math.random()*r*1e3+25)};n()})(t)};d();const l=document.querySelector("#site-structure .prompt");s(l,"System Ready / 系统就绪");const u=document.querySelector("#site-structure .floor .monitor"),p=document.querySelector("#site-structure .floor .monitor .poster");let m,f,h="";const v=()=>{var r,o,a;""!==n.value&&n.value!==h&&(s(l,"Generating / 生成中"),e.classList.add("processing"),n.blur(),r=n.value,o=r=>{f=y,e.classList.remove("processing"),s(l,"Poster Ready / 海报就绪"),p.src="data:image/jpeg; base64, "+r.image_data,h=n.value,n.addEventListener("input",(()=>{f=v,h="",p.src=t,s(l,"System Ready / 系统就绪")}),{once:!0})},a=t=>{switch(e.classList.remove("processing"),console.error("ERROR: "+t),t){case 1003:s(l,"Network Error / 网络错误");break;case 1002:s(l,"Sever Error / 服务器错误");break;case 1001:h=n.value,s(l,"Invalid input / 文本不规范")}},fetch("https://wnfafunctions.azurewebsites.net/api/wnfapostersgen",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r})}).then((e=>{200===e.status?e.json().then((e=>{o(e)})):400===e.status?a(1001):a(1002)})).catch((()=>{a(1003)})))},y=()=>{const e=document.querySelector("#site-posterview");e.innerHTML="";const t=document.createElement("img");t.classList.add("poster"),t.src=p.src,e.appendChild(t),e.addEventListener("click",(()=>{e.classList.remove("show")}),{once:!0}),e.classList.add("show")};m=()=>{},f=v,function(e,t,r){let o=!1;e.addEventListener("touchstart",(e=>{e.preventDefault(),o=!0,t()})),e.addEventListener("touchend",(e=>{e.preventDefault(),o=!1,r()})),e.addEventListener("touchcancel",(e=>{e.preventDefault(),o=!1,r()})),e.addEventListener("mousedown",(e=>{e.preventDefault(),o=!0,t()})),e.addEventListener("mouseup",(e=>{e.preventDefault(),o=!1,r()})),document.addEventListener("mouseup",(e=>{o&&(o=!1,r())}))}(u,(()=>{u.classList.add("pressed")}),(()=>{u.classList.remove("pressed"),f()}));const g=document.querySelector("#site-structure .floor .monitor .monitor-frame"),L=document.querySelector("#site-structure .floor .monitor"),b=a[Math.floor(Math.random()*a.length)];L.classList.add(b.class),p.addEventListener("load",(()=>{c.posterInit=!0}),{once:!0}),g.addEventListener("load",(()=>{c.frameInit=!0}),{once:!0}),p.src=t,g.src=b.url,document.fonts.ready.then((()=>{c.fontsLoaded=!0}))}window.addEventListener("load",(function(){i(),document.querySelector("#site-informative .loading");const e=document.querySelector("#site-informative .loading .prompt"),t=["·","· ·","· · ·"];let r=0,o=()=>{};setInterval((()=>{e.innerHTML="Loading / 载入中<br>"+t[r],r=(r+1)%t.length,o()}),750),setTimeout((()=>{o=()=>{c.frameInit&&c.posterInit&&c.fontsLoaded&&document.querySelector("#site-informative .loading").classList.add("hide")}}),2250)}))})();