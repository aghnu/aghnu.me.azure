(()=>{"use strict";const t={pointerX:0,pointerY:0,focusX:0,focusY:0,rotateDeg:0};const e=[],n="https://wnfa-interactive-art-project.github.io/hangzhou_060122/";function o(t,o){const r=[];let s,i;const l=t=>{const e=document.createElement("img"),n=50*Math.random(),o=80*Math.random(),r=360*Math.random(),s=6*Math.random()+2;return e.classList.add("poster"),e.style.top=o+"%",e.style.right=n+"%",e.style.transform=`rotateZ(${r}deg) rotateY(${r}deg)`,e.style.height=s+"em",e.style.opacity=0,e.src=t,e},a=t=>{r.push(t),e[Math.floor(Math.random()*e.length)].appendChild(t),setTimeout((()=>{t.style.opacity=.9}),100)},c=()=>{if(0!==r.length){const t=r.shift();t.style.opacity=0,setTimeout((()=>{t.parentElement.removeChild(t)}),1e3)}},d=(t=(()=>{}))=>{for(;0!==r.length;)c();t()},u=document.querySelector("#site-gallery-name"),h=()=>{"results"===o?((()=>{const e=t.results.total;let o=0;s=setInterval((()=>{a(l(n+"results/"+Math.floor(Math.random()*e+1)+".jpg")),++o>20&&(clearInterval(s),i=setInterval((()=>{c(),a(l(n+"results/"+Math.floor(Math.random()*e+1)+".jpg"))}),5e3))}),100)})(),u.innerHTML="WNFA/心的铁片"):"posters"===o&&(u.innerHTML="回想回想",(()=>{const e=t.posters.total;let o=1;s=setInterval((()=>{a(l(n+"posters/"+String(o)+".jpg")),++o>e&&clearInterval(s)}),100)})())};return h(),{clean:t=>{clearInterval(s),clearInterval(i),d(t)},refresh:()=>{clearInterval(s),clearInterval(i),d(h)}}}function r(){const r=document.querySelector("#site-interactive"),s=document.querySelector("#site-interactive .room"),i=document.querySelector("#site-interactive .room .gallery");(function(e,n,o){const r=()=>{const n=e.getBoundingClientRect();t.pointerX=n.left+n.width/2,t.pointerY=n.top+n.height/2,t.focusX=t.pointerX,t.focusY=t.pointerY},s=()=>{const t=o.getBoundingClientRect(),e=t.width/t.height,n=document.querySelector("#site-prompt"),r=document.querySelector("#site-prompt .prompt");e<.4||e>2.5?(r.innerHTML="Window ratio not supported",n.style.visibility="visible"):(n.style.visibility="hidden",r.innerHTML="")};r(),s(),o.onmousemove=e=>{t.pointerX=e.clientX,t.pointerY=e.clientY},o.ontouchmove=e=>{t.pointerX=e.touches[0].clientX,t.pointerY=e.touches[0].clientY},setInterval((()=>{t.rotateDeg=(t.rotateDeg+.1)%360,Math.abs(t.pointerX-t.focusX)>1&&(t.focusX=t.focusX+(t.pointerX-t.focusX)/12),Math.abs(t.pointerY-t.focusY)>1&&(t.focusY=t.focusY+(t.pointerY-t.focusY)/12),n.style.transform=`rotateY(${t.rotateDeg}deg)`,function(e,n){const o=e.getBoundingClientRect(),r=n.getBoundingClientRect(),s=r.height/r.width,i=10*s,l=10/s,a=o.left+o.width/2,c=o.top+o.height/2,d=t.focusX-a,u=t.focusY-c,h=d/(r.width/2),m=u/(r.height/2),p=h*i/((r.height+600)/600),g=-m*l/((r.width+600)/600);e.style.transform=`rotateX(${g}deg) rotateY(${p}deg)`}(e,o)}),1e3/60),window.addEventListener("resize",(()=>{s(),r()}))})(s,i,r),function(t){for(let n=0;n<6;n++){const o=60+60*n,r=document.createElement("div");r.classList.add("wall"),r.style.transform=`rotateY(${o}deg) translateX(-50%)`,e.push(r),t.appendChild(r)}var r;r=t=>{let e=["posters","results"],n=o(t,"results");document.querySelector("#site-button-refresh").onclick=()=>{n.refresh()},document.querySelector("#site-button-next").onclick=()=>{const r=e.shift();e.push(r),n.clean((()=>{n=o(t,r)}))};const r=document.querySelector("#site-button-info"),s=document.querySelector("#site-interactive .room .gallery"),i=()=>{s.style.visibility="hidden"},l=()=>{s.style.visibility="visible"};r.addEventListener("touchstart",(t=>{t.preventDefault(),i()})),r.addEventListener("touchend",(t=>{t.preventDefault(),l()})),r.addEventListener("touchcancel",(t=>{t.preventDefault(),l()})),r.addEventListener("mousedown",(t=>{t.preventDefault(),i()})),r.addEventListener("mouseup",(t=>{t.preventDefault(),l()})),document.addEventListener("mouseup",(t=>{l()}))},fetch(n+"META.json").then((t=>{200===t.status&&t.json().then((t=>{r(t)}))})).catch((t=>{console.log("error",t)}))}(i);const l=document.querySelector("#site-button-info"),a=document.querySelector("#site-button-next"),c=document.querySelector("#site-button-refresh"),d=document.createElement("div"),u=document.createElement("div"),h=document.createElement("div");d.classList.add("icon"),u.classList.add("icon"),h.classList.add("icon"),d.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="${"0.75em"}" viewBox="0 0 74 74"><rect width="74" height="74" fill="none"/><path d="M40.657,38.124h10.2L50.8,77.772H40.657ZM45.731,19a6.122,6.122,0,1,1-6.122,6.122A6.122,6.122,0,0,1,45.731,19Z" transform="translate(-8.786 -11.12)" fill="${"rgb(58, 58, 58)"}"/></svg>`,u.innerHTML=((t,e)=>`<svg xmlns="http://www.w3.org/2000/svg" width="${e}" viewBox="0 0 74 74"><rect width="74" height="74" fill="none"/><g transform="translate(-28.581 6.732)"><g transform="translate(48.224)"><g transform="translate(0)"><path d="M52.745,60.535l-4.521-4.57,26.546-25.7L48.224,4.568,52.745,0,82.939,30.269Z" transform="translate(-48.224)" fill="${t}"/></g></g></g></svg>`)("rgb(225, 225, 225)","0.75em"),h.innerHTML=((t,e)=>`<svg xmlns="http://www.w3.org/2000/svg" width="${e}" viewBox="0 0 74 74"><rect width="74" height="74" fill="none"/><path d="M55.148,13.867a29.123,29.123,0,0,0-7.136-7.619L54.23,0h-18.1V18.184l8.455-8.5a24.242,24.242,0,1,1-38.1,19.885A24.092,24.092,0,0,1,20.139,7.757L18.045,3.45a29.033,29.033,0,1,0,37.1,10.417Z" transform="translate(6.273 7.697)" fill="${t}"/></svg>`)("rgb(225, 225, 225)","0.75em"),l.appendChild(d),a.appendChild(u),c.appendChild(h)}window.addEventListener("load",(()=>{const t=document.querySelector("#site-prompt"),e=document.querySelector("#site-prompt .prompt"),n=["loading<br>.","loading<br>. .","loading<br>. . ."];let o=0,s=setInterval((()=>{e.innerHTML=n[o],o=(o+1)%n.length}),750);setTimeout((()=>{clearInterval(s),e.innerHTML="",t.style.visibility="hidden",r()}),3e3)}))})();